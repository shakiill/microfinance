{% extends 'includes/main.html' %}
{% load static %}

{% block content %}

    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <!-- Main Application Details Card -->
                <div class="card card-custom gutter-b">
                    <div class="card-header">
                        <h3 class="card-title">Application #{{ object.id }}: {{ object.customer.name }}</h3>
                        <div class="card-toolbar">
                            <!-- Modal for Editing Application -->

                            <button type="button" class="btn btn-success loan-edit" data-toggle="modal"
                                    data-target="#editApplicationModal">edit application
                            </button>

                            <div class="modal fade" id="editApplicationModal" tabindex="-1" role="dialog"
                                 aria-labelledby="editApplicationModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-lg" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="editApplicationModalLabel">Edit Application</h5>
                                            <button type="button" class="btn-close" data-dismiss="modal"
                                                    aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <form id="editApplicationForm">
                                                <div class="mb-3">
                                                    <label for="editAmount" class="form-label">Amount</label>
                                                    <input type="text" class="form-control" id="editAmount"
                                                           name="amount" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="editDuration" class="form-label">Duration
                                                        (Months)</label>
                                                    <input type="number" class="form-control" id="editDuration"
                                                           name="duration_months" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="editPurpose" class="form-label">Purpose</label>
                                                    <input type="text" class="form-control" id="editPurpose"
                                                           name="purpose">
                                                </div>

                                                <button type="submit" class="btn btn-primary">Save Changes</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <script>
                                // Function to open modal and fetch data
                                document.querySelector('.loan-edit').addEventListener('click', () => {
                                    fetch(`/api/v1/loan-applications/{{ object.id }}/`)
                                        .then(response => response.json())
                                        .then(data => {
                                            // Populate the form with the fetched data
                                            document.querySelector('#editAmount').value = data.amount;
                                            document.querySelector('#editDuration').value = data.duration_months;
                                            document.querySelector('#editPurpose').value = data.purpose;

                                            // Show the modal
                                            $('#editApplicationModal').modal('show');
                                        })
                                        .catch(error => console.error('Error fetching application data: ', error));
                                });

                                // Form submission to update application
                                document.querySelector('#editApplicationForm').addEventListener('submit', (event) => {
                                    event.preventDefault();

                                    // Form data gathering
                                    const formData = new FormData(event.target);
                                    const formObject = Object.fromEntries(formData.entries());

                                    fetch(`/api/v1/loan-applications/{{ object.id }}/`, {
                                        method: 'PATCH', // Use PATCH method to update the application',
                                        headers: {
                                            'Content-Type': 'application/json', // Set correct content type
                                            'X-CSRFToken': '{{ csrf_token }}', // Include CSRF token for Django
                                            'Accept': 'application/json'
                                        },
                                        body: JSON.stringify(formObject) // Send data as JSON
                                    })
                                        .then(response => {
                                            if (response.ok) {
                                                // Refresh the page to update the template upon success
                                                location.reload();
                                            } else {
                                                return response.json().then(data => {
                                                    console.error('Error updating application: ', data);
                                                });
                                            }
                                        })
                                        .catch(error => console.error('Error during update request: ', error));
                                });
                            </script>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3"><strong>Amount:</strong> {{ object.amount }}</div>
                            <div class="col-md-3"><strong>Duration:</strong> {{ object.duration_months }} months</div>
                            <div class="col-md-3"><strong>Status:</strong> {{ object.status }}</div>
                            <div class="col-md-3"><strong>Applied Date:</strong> {{ object.applied_date }}</div>
                        </div>
                    </div>
                </div>

                <!-- Tabs Navigation -->
                <ul class="nav nav-tabs" id="loanTabs" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#products">Products</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#guarantors">Guarantors</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#assets">Assets</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#financials">Financial Records</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#checks">Check Info</a>
                    </li>
                </ul>

                <!-- Tab Content -->
                <div class="tab-content mt-3">
                    <!-- Products Tab -->
                    <div class="tab-pane fade show active" id="products">
                        <div class="card card-custom">
                            <div class="card-header">
                                <h3 class="card-title">Products</h3>
                                <div class="card-toolbar">
                                    <button class="btn btn-success btn-sm product-add" data-toggle="modal"
                                            data-target="#createProductModal">Add Product
                                    </button>

                                    <div class="modal fade" id="createProductModal" tabindex="-1" role="dialog"
                                         aria-labelledby="createProductModalLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-lg" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="createProductModalLabel">Add
                                                        Product</h5>
                                                    <button type="button" class="btn-close" data-dismiss="modal"
                                                            aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <form id="createProductForm">
                                                        <div style="display: none">
                                                            <input type="text" class="form-control" id="loanApplication"
                                                                   name="loan_application" value="{{ object.pk }}" required>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="productName" class="form-label">Product
                                                                Name</label>
                                                            <input type="text" class="form-control" id="productName"
                                                                   name="product_name" required>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="unitType" class="form-label">Unit Type</label>
                                                            <input type="text" class="form-control" id="unitType"
                                                                   maxlength="10"
                                                                   name="unit_type" required>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="units" class="form-label">Units</label>
                                                            <input type="number" class="form-control" id="units"
                                                                   name="units" required>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="unitPrice" class="form-label">Unit Price</label>
                                                            <input type="number" step="0.01" class="form-control"
                                                                   id="unitPrice" name="unit_price" required>
                                                        </div>
                                                        <button type="submit" class="btn btn-primary">Save Product
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <script>
                                        // Function to open modal and fetch data
                                        document.querySelector('.product-add').addEventListener('click', () => {
                                            $('#createProductModal').modal('show');
                                        });
                                        // AJAX form submission for creating a product
                                        document.getElementById('createProductForm').addEventListener('submit',
                                            function (event) {
                                                event.preventDefault(); // Prevent default form submission

                                                // Collect form data
                                                const formData = new FormData(this);

                                                // Send AJAX request
                                                fetch('/api/v1/application-products/', { // Replace with your endpoint for product creation
                                                    method: 'POST',
                                                    body: formData,
                                                    headers: {
                                                        'X-CSRFToken': '{{ csrf_token }}' // Ensure CSRF token is included
                                                    }
                                                })
                                                    .then(response => {
                                                        if (response.ok) {
                                                            return response.json();
                                                        } else {
                                                            throw new Error('Failed to create product.');
                                                        }
                                                    })
                                                    .then(data => {
                                                        // Handle success
                                                        alert('Product created successfully!');
                                                        $('#createProductModal').modal('hide');
                                                        const params = new URLSearchParams(window.location.search);
                                                        params.set("tab", "product");  // Set or update the 'tab' parameter
                                                        window.location.replace(window.location.pathname + "?" + params.toString());
                                                    })
                                                    .catch(error => {
                                                        // Handle error
                                                        console.error('Error:', error);
                                                        alert('An error occurred while creating the product.');
                                                    });
                                            });
                                    </script>

                                </div>
                            </div>
                            <div class="card-body">
                                <table class="table table-bordered datatable">
                                    <thead>
                                    <tr>
                                        <th>Product Name</th>
                                        <th>Unit Type</th>
                                        <th>Units</th>
                                        <th>Unit Price</th>
                                        <th>Total Price</th>
                                        <th>Action</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for product in products %}
                                        <tr data-id="{{ product.id }}">
                                            <td>{{ product.product_name }}</td>
                                            <td>{{ product.unit_type }}</td>
                                            <td>{{ product.unit }}</td>
                                            <td>{{ product.unit_price }}</td>
                                            <td>{{ product.total_price }}</td>
                                            <td>
                                                <button type="button" class="btn btn-secondary update-product"
                                                        data-id="{{ product.id }}">Edit
                                                </button>
                                                <button type="button" class="btn btn-danger delete-product"
                                                        data-id="{{ product.id }}">Delete
                                                </button>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>

                                    <script>
                                        // AJAX handler for updating a product
                                        document.querySelectorAll('.update-product').forEach(button => {
                                            button.addEventListener('click', function () {
                                                const productId = this.dataset.id;

                                                // Fetch existing product data and open a modal for editing (you can create/edit a modal for this)
                                                fetch(`/api/v1/application-products/${productId}/`)
                                                    .then(response => {
                                                        if (response.ok) {
                                                            return response.json();
                                                        } else {
                                                            throw new Error('Failed to fetch product details.');
                                                        }
                                                    })
                                                    .then(data => {
                                                        // Populate the modal fields with the fetched product data
                                                        document.querySelector('#productName').value = data.product_name;
                                                        document.querySelector('#unitType').value = data.unit_type;
                                                        document.querySelector('#units').value = data.unit;
                                                        document.querySelector('#unitPrice').value = data.unit_price;

                                                        // Save the updated product data
                                                        document.querySelector('#createProductForm').onsubmit = function (event) {
                                                            event.preventDefault();

                                                            // Collect updated data
                                                            const updatedData = new FormData(this);

                                                            // AJAX request to update product
                                                            fetch(`/api/v1/application-products/${productId}/`, {
                                                                method: 'PUT',
                                                                body: updatedData,
                                                                headers: {
                                                                    'X-CSRFToken': '{{ csrf_token }}'
                                                                }
                                                            })
                                                                .then(response => {
                                                                    if (response.ok) {
                                                                        return response.json();
                                                                    } else {
                                                                        throw new Error('Failed to update product.');
                                                                    }
                                                                })
                                                                .then(() => {
                                                                    alert('Product updated successfully!');
                                                                    $('#createProductModal').modal('hide');
                                                                    const params = new URLSearchParams(window.location.search);
                                                                    params.set("tab", "product");  // Set or update the 'tab' parameter
                                                                    window.location.replace(window.location.pathname + "?" + params.toString());
                                                                })
                                                                .catch(error => {
                                                                    console.error('Error:', error);
                                                                    alert('An error occurred while updating the product.');
                                                                });
                                                        };

                                                        // Show the modal
                                                        $('#createProductModal').modal('show');
                                                    })
                                                    .catch(error => {
                                                        console.error('Error:', error);
                                                        alert('An error occurred while fetching product details.');
                                                    });
                                            });
                                        });

                                        // AJAX handler for deleting a product
                                        document.querySelectorAll('.delete-product').forEach(button => {
                                            button.addEventListener('click', function () {
                                                const productId = this.dataset.id;

                                                if (confirm('Are you sure you want to delete this product?')) {
                                                    // AJAX request to delete product
                                                    fetch(`/api/v1/application-products/${productId}/`, {
                                                        method: 'DELETE',
                                                        headers: {
                                                            'X-CSRFToken': '{{ csrf_token }}'
                                                        }
                                                    })
                                                        .then(response => {
                                                            if (response.ok) {
                                                                alert('Product deleted successfully!');
                                                                $('#createProductModal').modal('hide');
                                                                const params = new URLSearchParams(window.location.search);
                                                                params.set("tab", "product");  // Set or update the 'tab' parameter
                                                                window.location.replace(window.location.pathname + "?" + params.toString());
                                                            } else {
                                                                throw new Error('Failed to delete product.');
                                                            }
                                                        })
                                                        .catch(error => {
                                                            console.error('Error:', error);
                                                            alert('An error occurred while deleting the product.');
                                                        });
                                                }
                                            });
                                        });
                                    </script>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Guarantors Tab -->
                    <div class="tab-pane fade" id="guarantors">
                        <div class="card card-custom">
                            <div class="card-header">
                                <h3 class="card-title">Guarantors</h3>
                                <div class="card-toolbar">
                                    <button class="btn btn-success btn-sm guarantor-add" data-toggle="modal"
                                            data-target="#createGuarantorModal">Add Guarantor
                                    </button>
                                </div>
                            </div>

                            <div class="card-body">
                                <table class="table table-bordered datatable">
                                    <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Relationship</th>
                                        <th>Mobile</th>
                                        <th>Address</th>
                                        <th>Deposit Amount</th>
                                        <th>Actions</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for guarantor in guarantors %}
                                        <tr data-id="{{ guarantor.id }}">
                                            <td>{{ guarantor.name }}</td>
                                            <td>{{ guarantor.relationship }}</td>
                                            <td>{{ guarantor.mobile }}</td>
                                            <td>{{ guarantor.address }}</td>
                                            <td>{{ guarantor.deposit_amount }}</td>
                                            <td>
                                                <button type="button" class="btn btn-secondary update-guarantor"
                                                        data-id="{{ guarantor.id }}">Edit
                                                </button>
                                                <button type="button" class="btn btn-danger delete-guarantor"
                                                        data-id="{{ guarantor.id }}">Delete
                                                </button>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                         {#                                    modal start #}
                            <div class="modal fade" id="createGuarantorModal" tabindex="-1"
                                 role="dialog" aria-labelledby="createGuarantorModalLabel"
                                 aria-hidden="true">
                                <div class="modal-dialog modal-lg" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title"
                                                id="createGuarantorModalLabel">Add
                                                Guarantor</h5>
                                            <button type="button" class="btn-close"
                                                    data-dismiss="modal"
                                                    aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <form id="createGuarantorForm">
                                                <div style="display: none">
                                                    <input type="text" class="form-control"
                                                           id="loanApplicationGuarantor"
                                                           name="loan_application"
                                                           value="{{ object.pk }}" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="guarantorName"
                                                           class="form-label">Name</label>
                                                    <input type="text" class="form-control"
                                                           id="guarantorName" name="name"
                                                           required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="fatherName"
                                                           class="form-label">Father's Name</label>
                                                    <input type="text" class="form-control"
                                                           id="fatherName" name="father"
                                                           required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="motherName"
                                                           class="form-label">Mother's Name</label>
                                                    <input type="text" class="form-control"
                                                           id="motherName" name="mother"
                                                           required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="relationship"
                                                           class="form-label">Relationship</label>
                                                    <input type="text" class="form-control"
                                                           id="relationship" name="relationship"
                                                           required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="mobile" class="form-label">Mobile</label>
                                                    <input type="text" class="form-control"
                                                           id="mobile" name="mobile" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="address" class="form-label">Address</label>
                                                    <input type="text" class="form-control"
                                                           id="address" name="address" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="depositAmount"
                                                           class="form-label">Deposit
                                                        Amount</label>
                                                    <input type="number" step="0.01"
                                                           class="form-control"
                                                           id="depositAmount"
                                                           name="deposit_amount" required>
                                                </div>
                                                <button type="submit" class="btn btn-primary">
                                                    Save Guarantor
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <script>
                                document.querySelector('.guarantor-add').addEventListener('click', () => {
                                    $('#createGuarantorModal').modal('show');
                                });

                                document.getElementById('createGuarantorForm').addEventListener('submit', function (event) {
                                    event.preventDefault();
                                    const formData = new FormData(this);

                                    fetch('/api/v1/guarantors/', {
                                        method: 'POST',
                                        body: formData,
                                        headers: {
                                            'X-CSRFToken': '{{ csrf_token }}'
                                        }
                                    })
                                        .then(response => {
                                            if (response.ok) {
                                                return response.json();
                                            } else {
                                                throw new Error('Failed to create guarantor.');
                                            }
                                        })
                                        .then(data => {
                                            alert('Guarantor created successfully!');
                                            $('#createGuarantorModal').modal('hide');
                                            const params = new URLSearchParams(window.location.search);
                                            params.set("tab", "guarantors");  // Set or update the 'tab' parameter
                                            window.location.replace(window.location.pathname + "?" + params.toString());
                                        })
                                        .catch(error => {
                                            console.error('Error:', error);
                                            alert('An error occurred while creating the guarantor.');
                                        });
                                });

                                document.querySelectorAll('.update-guarantor').forEach(button => {
                                    button.addEventListener('click', function () {
                                        const guarantorId = this.dataset.id;

                                        fetch(`/api/v1/guarantors/${guarantorId}/`)
                                            .then(response => {
                                                if (response.ok) {
                                                    return response.json();
                                                } else {
                                                    throw new Error('Failed to fetch guarantor details.');
                                                }
                                            })
                                            .then(data => {
                                                document.getElementById('guarantorName').value = data.name;
                                                document.getElementById('fatherName').value = data.father;
                                                document.getElementById('motherName').value = data.mother;
                                                document.getElementById('relationship').value = data.relationship;
                                                document.getElementById('mobile').value = data.mobile;
                                                document.getElementById('address').value = data.address;
                                                document.getElementById('depositAmount').value = data.deposit_amount;

                                                document.getElementById('createGuarantorForm').onsubmit = function (event) {
                                                    event.preventDefault();
                                                    const updatedData = new FormData(this);

                                                    fetch(`/api/v1/guarantors/${guarantorId}/`, {
                                                        method: 'PUT',
                                                        body: updatedData,
                                                        headers: {
                                                            'X-CSRFToken': '{{ csrf_token }}'
                                                        }
                                                    })
                                                        .then(response => {
                                                            if (response.ok) {
                                                                return response.json();
                                                            } else {
                                                                throw new Error('Failed to update guarantor.');
                                                            }
                                                        })
                                                        .then(() => {
                                                            alert('Guarantor updated successfully!');
                                                            $('#createGuarantorModal').modal('hide');
                                                            const params = new URLSearchParams(window.location.search);
                                                            params.set("tab", "guarantors");  // Set or update the 'tab' parameter
                                                            window.location.replace(window.location.pathname + "?" + params.toString());
                                                        })
                                                        .catch(error => {
                                                            console.error('Error:', error);
                                                            alert('An error occurred while updating the guarantor.');
                                                        });
                                                };

                                                $('#createGuarantorModal').modal('show');
                                            })
                                            .catch(error => {
                                                console.error('Error:', error);
                                                alert('An error occurred while fetching guarantor details.');
                                            });
                                    });
                                });

                                document.querySelectorAll('.delete-guarantor').forEach(button => {
                                    button.addEventListener('click', function () {
                                        const guarantorId = this.dataset.id;

                                        if (confirm('Are you sure you want to delete this guarantor?')) {
                                            fetch(`/api/v1/guarantors/${guarantorId}/`, {
                                                method: 'DELETE',
                                                headers: {
                                                    'X-CSRFToken': '{{ csrf_token }}'
                                                }
                                            })
                                                .then(response => {
                                                    if (response.ok) {
                                                        alert('Guarantor deleted successfully!');
                                                        const params = new URLSearchParams(window.location.search);
                                                        params.set("tab", "guarantors");  // Set or update the 'tab' parameter
                                                        window.location.replace(window.location.pathname + "?" + params.toString());
                                                    } else {
                                                        throw new Error('Failed to delete guarantor.');
                                                    }
                                                })
                                                .catch(error => {
                                                    console.error('Error:', error);
                                                    alert('An error occurred while deleting the guarantor.');
                                                });
                                        }
                                    });
                                });
                            </script>
                            {#                                    end modal#}
                        </div>
                    </div>

                    <!-- Assets Tab -->
                    <div class="tab-pane fade" id="assets">
                        <div class="card card-custom">
                            <div class="card-header">
                                <h3 class="card-title">Assets</h3>
                                <div class="card-toolbar">
                                    <button class="btn btn-success btn-sm">Add Asset</button>
                                </div>
                            </div>
                            <div class="card-body">
                                <table class="table table-bordered datatable">
                                    <thead>
                                    <tr>
                                        <th>Land Type</th>
                                        <th>Owner</th>
                                        <th>Area</th>
                                        <th>Value</th>
                                        <th>Documents</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for asset in assets %}
                                        <tr data-id="{{ asset.id }}">
                                            <td>{{ asset.get_land_type_display }}</td>
                                            <td>{{ asset.owner_name }}</td>
                                            <td>{{ asset.land_area }}</td>
                                            <td>{{ asset.estimated_value }}</td>
                                            <td>
                                                {% if asset.document %}
                                                    <a href="{{ asset.document.url }}" target="_blank">View</a>
                                                {% endif %}
                                            </td>

                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Financial Records Tab -->
                    <div class="tab-pane fade" id="financials">
                        <div class="card card-custom">
                            <div class="card-header">
                                <h3 class="card-title">Financial Records</h3>
                                <div class="card-toolbar">
                                    <button class="btn btn-success btn-sm">Add Record
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <table class="table table-bordered datatable">
                                    <thead>
                                    <tr>
                                        <th>Type</th>
                                        <th>Institution</th>
                                        <th>Amount</th>
                                        <th>Interest Rate</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for record in financials %}
                                        <tr data-id="{{ record.id }}">
                                            <td>{{ record.get_record_type_display }}</td>
                                            <td>{{ record.institution_name }}</td>
                                            <td>{{ record.amount }}</td>
                                            <td>{{ record.interest_rate }}%</td>
                                            <td>{{ record.status }}</td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Check Info Tab -->
                    <div class="tab-pane fade" id="checks">
                        <div class="card card-custom">
                            <div class="card-header">
                                <h3 class="card-title">Check Information</h3>
                                <div class="card-toolbar">
                                    <button class="btn btn-success btn-sm">Add Check</button>
                                </div>
                            </div>
                            <div class="card-body">
                                <table class="table table-bordered datatable">
                                    <thead>
                                    <tr>
                                        <th>Account Name</th>
                                        <th>Account No</th>
                                        <th>Check No</th>
                                        <th>Bank</th>
                                        <th>Branch</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for check in checks %}
                                        <tr data-id="{{ check.id }}">
                                            <td>{{ check.account_name }}</td>
                                            <td>{{ check.account_no }}</td>
                                            <td>{{ check.check_no }}</td>
                                            <td>{{ check.bank_name }}</td>
                                            <td>{{ check.branch_name }}</td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block js %}

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Get the current URL
            const urlParams = new URLSearchParams(window.location.search);
            // Check if 'tab' parameter exists in the URL
            const activeTab = urlParams.get('tab');

            if (activeTab) {
                // Find the tab link and content to activate using the URL parameter
                const tabLink = document.querySelector(`[href="#${activeTab}"]`);
                const tabPane = document.querySelector(`#${activeTab}`);

                if (tabLink && tabPane) {
                    // Deactivate currently active tab
                    document.querySelector('.nav-link.active')?.classList.remove('active');
                    document.querySelector('.tab-pane.show.active')?.classList.remove('show', 'active');

                    // Activate the tab based on the URL parameter
                    tabLink.classList.add('active');
                    tabPane.classList.add('show', 'active');
                }
            }
        });
    </script>
{% endblock %}